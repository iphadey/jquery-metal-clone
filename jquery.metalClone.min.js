!function(e){e.fn.metalClone=function(n,t){opt=cloned=e.extend({},e.fn.metalClone.defaults,n);var o=clonedElement=this;return o.each(function(){function n(n,t,o,a){var l,p=t,c="",u="",d=[];if(n=0==n?1:n,"after"===a){if(-1!==e.inArray(m,D)&&-1!==e.inArray(T,D))for(var f=0;n>f;f++){if(l=s())return;c=p.clone(),c.insertAfter(o.find("tr").last()),c.find("td").last().append('<div class="operation-container"><div class="operations"><div class="metalBtnRemove operationsImg metalDeleteBtn"><span>'+C+"</span></div></div></div>"),v||i(c),d.push(c)}else if(-1!==e.inArray(m,D)&&-1==e.inArray(T,D))for(var f=0;n>f;f++){if(l=s())return;c=p.clone(),o.append(c.append('<input type="button" value="'+C+'" class="metalBtnRemove">')),v||i(c),d.push(c)}else if(-1==e.inArray(m,D)&&-1==e.inArray(T,D))for(var f=0;n>f;f++){if(l=s())return;c=p.clone(),o.append(c.append('<input type="button" value="'+C+'" class="metalBtnRemove">')),v||i(c),d.push(c)}else if(-1==e.inArray(m,D)&&-1!==e.inArray(T,D))for(var f=0;n>f;f++){if(l=s())return;c=p.clone(),o.append(c.append('<input type="button" value="'+C+'" class="metalBtnRemove">')),v||i(c),d.push(c)}}else if("before"===a)if(-1!==e.inArray(m,D)&&-1!==e.inArray(T,D))for(var f=0;n>f;f++){if(l=s())return;c=p.clone(),c.insertAfter(o.find("tr").first()),c.find("td").last().append('<div class="operation-container"><div class="operations"><div class="metalBtnRemove operationsImg metalDeleteBtn"><span>'+C+"</span></div></div></div>"),v||i(c),d.push(c)}else if(-1!==e.inArray(m,D)&&-1==e.inArray(T,D))for(var f=0;n>f;f++){if(l=s())return;c=p.clone(),o.prepend(c.append('<input type="button" value="'+C+'" class="metalBtnRemove">')),v||i(c),d.push(c)}else if(-1==e.inArray(m,D)&&-1==e.inArray(T,D))for(var f=0;n>f;f++){if(l=s())return;c=p.clone(),o.prepend(c.append('<input type="button" value="'+C+'" class="metalBtnRemove">')),v||i(c),d.push(c)}else if(-1==e.inArray(m,D)&&-1!==e.inArray(T,D))for(var f=0;n>f;f++){if(l=s())return;c=p.clone(),o.prepend(c.append('<input type="button" value="'+C+'" class="metalBtnRemove">')),v||i(c),d.push(c)}return e.isArray(b)&&e.isEmptyObject(b)?u=e.map(d,function(n,t){return e(n).get(0)}):e.isArray(b)&&!e.isEmptyObject(b)&&(u=r(b)),u}function t(n,t,o,a){var l,p=t,c="",u="",d=[];if(n=0==n?1:n,"after"===a){if(-1!==e.inArray(m,D))for(var f=0;n>f;f++){if(l=s())return;c=p.clone(),c.insertAfter(o),c.find("td").last().append('<div class="operation-container"><div class="operations"><div class="metalBtnRemove operationsImg metalDeleteBtn"><span>'+C+"</span></div></div></div>"),v||i(c),d.push(c)}if(-1==e.inArray(m,D))for(var f=0;n>f;f++){if(l=s())return;c=p.clone(),c.insertAfter(o).append('<input type="button" value="'+C+'" class="metalBtnRemove">'),v||i(c),d.push(c)}}else if("before"===a)if(-1!==e.inArray(m,D))for(var f=0;n>f;f++){if(l=s())return;c=p.clone(),c.insertBefore(o),c.find("td").last().append('<div class="operation-container"><div class="operations"><div class="metalBtnRemove operationsImg metalDeleteBtn"><span>'+C+"</span></div></div></div>"),v||i(c),d.push(c)}else for(var f=0;n>f;f++){if(l=s())return;c=p.clone(),c.insertBefore(o).append('<input type="button" value="'+C+'" class="metalBtnRemove">'),v||i(c),d.push(c)}return e.isArray(b)&&e.isEmptyObject(b)?u=e.map(d,function(n,t){return e(n).get(0)}):e.isArray(b)&&!e.isEmptyObject(b)&&(u=r(b)),u}function i(n){n.find('input:not("input[type=button], input[type=submit], input[type=checkbox], input[type=radio]"), textarea, select').each(function(){e(this).val("")})}function r(n){var t,o=[];return t=e.inArray("*",n)?"*":n.join(","),e(d).not(":first").each(function(n,i){e(this).find(t).each(function(t,o){if(e(this).attr("id")){var i=e(this).attr("id"),r=i.replace(/\d+/g,"");e(this).attr("id",r+parseInt(n))}}),o.push(e(this).get(0))}),o}function a(){var n;return n=O?e(d).length:e('[id="'+o[0].id+'"').length,"infinity"!=B&&"number"==typeof B?A>B?!1:n:"no limit"}function l(){var e;return e=O?d.replace(".",""):d.replace("#","")}function s(){var n,t=a(),o=!1;if(t?n="no limit"==t?0:t:(console.log("Number to clone more than limit"),o=!0),n>B){if(console.log("Can't clone more than limit provided"),e(j).next().is("span"))e(j).next().html(x);else{var i=l();e("<span/>",{"data-clone-reference":i,"class":"error_limit",text:x}).insertAfter(j)}o=!0}return o}if(void 0==e(document).data("metalClone-"+o.selector)){e(document).data("metalClone-"+o.selector,"metalClone");var p,c,u,d=o.selector,f=d.replace(/^(\.|\#)/,""),m=o[0].nodeName,v=opt.copyValue,y=opt.position,A=opt.numberToClone,h=opt.destination,b=opt.ids,C=opt.btnRemoveText,T=h?e(h)[0].nodeName:"none",B=opt.cloneLimit,x=opt.cloneLimitText,R=opt.onStart,w=opt.onClone,g=opt.onComplete,E=opt.onClonedRemoved,D=["TABLE","TR","TD","TBODY","TFOOT","THEAD","TH"],O=!1;d.match(/[.]/)?(O=!0,p=e(this).first()):p=e(this),e.isFunction(R)&&R.call(o,o),-1!==e.inArray(m,D)&&(c=p.closest("table"),u=c.find("tr").first());var j;null===opt.btnClone?(j="metalBtnClone"+Math.floor(99999999999*Math.random()+1),-1!==e.inArray(m,D)&&-1==e.inArray(T,D)?e("<input/>",{type:"button",value:opt.btnCloneText,"class":j,css:{marginTop:"10px"}}).insertAfter(c):-1!==e.inArray(m,D)&&-1!==e.inArray(T,D)?e("<input/>",{type:"button",value:opt.btnCloneText,"class":j,css:{marginTop:"10px"}}).insertAfter(c):-1==e.inArray(m,D)&&-1==e.inArray(T,D)?e("<input/>",{type:"button",value:opt.btnCloneText,"class":j,css:{marginTop:"10px"}}).insertAfter(d):-1==e.inArray(m,D)&&-1!==e.inArray(T,D)&&e("<input/>",{type:"button",value:opt.btnCloneText,"class":j,css:{marginTop:"10px"}}).insertAfter(d),j="."+j):j=opt.btnClone,e(document).on({mouseenter:function(){e(this).find(".operations").css({display:"block"})},mouseleave:function(){e(this).find(".operations").css({display:"none"})}},d),e(document).on("click",j,function(){var i,r="";return function(e){opt.cancelClone=function(n){n&&(window[e+"cancelClone"]=n)},opt.removeCloned=function(n){n&&(window[e+"removeCloned"]=n)}}(f),e.isFunction(w)&&w.call(o,o,cloned),window[f+"cancelClone"]&&void 0!==typeof window[f+"cancelClone"]?void delete window[f+"cancelClone"]:(h!==!1?(i=e(h),r="after"===y?n(A,p,i,y):n(A,p,i,y)):(i=e(d),r="after"===y?t(A,p,i.last(),y):t(A,p,i.first(),y)),e.isFunction(g)&&g.call(o,clonedElement,cloned,r),void(window[f+"removeCloned"]&&void 0!==typeof window[f+"removeCloned"]&&(delete window[f+"removeCloned"],e(r).remove(),e.isFunction(E)&&E.call(o,r))))}),e(document).on("click",".metalBtnRemove",function(){var n=l(),t=e(this).closest(d).remove();e("body").find('[data-clone-reference="'+n+'"]').remove(),e.isFunction(E)&&E.call(o,t)})}})},e.fn.metalClone.defaults={destination:!1,position:"after",numberToClone:1,ids:[],btnClone:null,copyValue:!1,btnRemoveText:"Remove me",btnCloneText:"Create New Element",cloneLimit:"infinity",cloneLimitText:"Clone limit reached",onStart:null,onClone:null,onComplete:null,onClonedRemoved:null}}(jQuery);